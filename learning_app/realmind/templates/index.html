<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RealMindX | {% block title %}{% endblock %}</title>

  <link rel="icon" type="image/png" sizes="256x256" href="{{ url_for('static', filename='images/brain.png') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

  <link href="https://fonts.googleapis.com/css2?family=Arimo:wght@400;600&family=Montserrat:wght@500;600;700&display=swap"
        rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
  
  <style>
    /* Center align text in yellow dashboard nav */
    .user-dashboard-nav .nav-link-divider {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    /* Keep logo within navbar bounds */
    .navbar-brand .logo-img {
      max-height: 50px;
      width: auto;
      object-fit: contain;
    }
    
    /* Hide logo in collapsed menu */
    .navbar-collapse .navbar-brand-mobile {
      display: none !important;
    }
    
    /* Hide the main navbar-brand when it's inside the collapse on mobile */
    
  
  </style>
</head>
<body class="home-page">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg custom-navbar fixed-top {% if current_user.is_authenticated %}authenticated-navbar{% endif %}">
  <div class="container-fluid px-0 navbar-mobile-grid">

    <!-- Mobile toggle (left) -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Logo (center on mobile, left on desktop) -->
    <a class="navbar-brand d-flex align-items-center"
       href="{{ url_for('main.home') if not current_user.is_authenticated else url_for('user.users_dashboard') }}">
      <img src="{{ url_for('static', filename='images/real.jpg') }}" alt="RealmindX Logo" class="logo-img">
    </a>

    <!-- If user NOT logged in -->
    {% if not current_user.is_authenticated %}

    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav text-center">

        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}">HOME</a></li>

        <!-- About -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="{{ url_for('main.about') }}" data-bs-toggle="dropdown">ABOUT</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#who">Who We Are</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#mission">Our Mission</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#vision">Our Vision</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#goals">Our Goals</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#choose-realmindx">Why Choose Us</a></li>
          </ul>
        </li>

        <!-- Services -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="{{ url_for('main.services') }}" data-bs-toggle="dropdown">SERVICES</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#teacher-recruitment">Teacher Recruitment</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#teacher-development">Teacher Development</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#school-structuring">School Structuring</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#bookshop">Bookshop</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#after-school">Tutoring</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#special-education">Special Education</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#secretarial">Secretarial Services</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#consulting">Educational Consulting</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#extracurricular">ExtraCurricular Offers</a></li>
          </ul>
        </li>

        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.news') }}">NEWS</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.gallery') }}">GALLERY</a></li>
        <li class="nav-item"><a class="nav-link" href="https://bookshop.realmindxgh.com" target="_blank">BOOKSHOP</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contact') }}">CONTACT</a></li>

        <!-- Teaching Jobs -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">TEACHING JOBS</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('jobs.job_listings') }}">Job Posts</a></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.user_login') }}">Login</a></li>
            <li><a class="dropdown-item" href="{{ url_for('auth.user_signup') }}">Sign Up</a></li>
          </ul>
        </li>
      </ul>

      <!-- Mobile DONATE -->
      <div class="text-center mt-3 d-lg-none">
        <a href="{{ url_for('donation.donate') }}" class="btn btn-warning btn-donate">DONATE</a>
      </div>
    </div>

    <!-- Desktop donate -->
    <div class="d-none d-lg-block">
      <a href="{{ url_for('donation.donate') }}" class="btn btn-warning btn-donate ms-2">DONATE</a>
    </div>

    <!-- END NOT AUTHENTICATED -->
    {% else %}

    <!-- ====================================== -->
    <!-- AUTHENTICATED USER NAVBAR (UPDATED) -->
    <!-- ====================================== -->

    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav text-center">

        <!-- Public links STILL show -->
        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.home') }}">HOME</a></li>

        <!-- ABOUT -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">ABOUT</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#who">Who We Are</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#mission">Our Mission</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#vision">Our Vision</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#goals">Our Goals</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.about') }}#choose-realmindx">Why Choose Us</a></li>
          </ul>
        </li>

        <!-- SERVICES -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">SERVICES</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#teacher-recruitment">Teacher Recruitment</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#teacher-development">Teacher Development</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#school-structuring">School Structuring</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#bookshop">Bookshop</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#after-school">Tutoring</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#special-education">Special Education</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#secretarial">Secretarial Services</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#consulting">Educational Consulting</a></li>
            <li><a class="dropdown-item" href="{{ url_for('main.services') }}#extracurricular">ExtraCurricular Offers</a></li>
          </ul>
        </li>

        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.news') }}">NEWS</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.gallery') }}">GALLERY</a></li>
        <li class="nav-item"><a class="nav-link" href="https://bookshop.realmindxgh.com" target="_blank">BOOKSHOP</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('main.contact') }}">CONTACT</a></li>

        <!-- Teaching Jobs when logged in -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">TEACHING JOBS</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{ url_for('jobs.job_listings') }}">Job Posts</a></li>
          </ul>
        </li>

        <!-- Mobile DONATE (inside collapsed menu) -->
        <li class="nav-item d-lg-none text-center mt-2">
          <a href="{{ url_for('donation.donate') }}" class="btn btn-warning btn-donate">DONATE</a>
        </li>
      </ul>
    </div>

    <!-- Profile + Donate (OUTSIDE collapse, always visible on right) -->
    <div class="d-flex align-items-center ms-auto">
      <!-- Profile dropdown -->
      <div class="dropdown">
        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false">
          
          {% if current_user.profile_pic %}
            <img src="{{ url_for('static',
                                  filename='uploads/users/user_' ~ current_user.id ~
                                            '/profile/' ~ current_user.profile_pic) }}"
                  width="38" height="38"
                  class="rounded-circle border"
                  style="object-fit: cover;">
          {% else %}
              <img src="{{ url_for('static', filename='images/default-profile.webp') }}"
                  width="38" height="38"
                  class="rounded-circle border"
                  style="object-fit: cover;">
          {% endif %}
        </a>

        <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown">
          <li><a class="dropdown-item" href="{{ url_for('user.users_dashboard') }}">Dashboard</a></li>
          <li><a class="dropdown-item" href="{{ url_for('user.view_profile') }}">View Profile</a></li>
          <li><a class="dropdown-item" href="{{ url_for('user.edit_profile') }}">Edit Profile</a></li>
          <li><a class="dropdown-item" href="{{ url_for('jobs.job_listings') }}">Apply for a job</a></li>
          <li><a class="dropdown-item" href="{{ url_for('user.application_history') }}">Application History</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger fw-bold" href="{{ url_for('auth.user_logout') }}">Logout</a></li>
        </ul>
      </div>

      <!-- Donate (desktop only) -->
      <div class="d-none d-lg-block ms-2">
        <a href="{{ url_for('donation.donate') }}" class="btn btn-warning btn-donate">DONATE</a>
      </div>
    </div>

    {% endif %}
  </div>
</nav>


{% if current_user.is_authenticated and request.endpoint and (request.endpoint.startswith('user.') or request.endpoint.startswith('jobs.')) %}
<div class="user-dashboard-nav text-center">
  <div class="links-wrapper">
    <!-- Dashboard hidden on mobile via CSS -->
    <a href="{{ url_for('user.users_dashboard') }}"
       class="nav-link-divider hide-mobile">
      Dashboard
    </a>

    <a href="{{ url_for('user.view_profile') }}" class="nav-link-divider">View Profile</a>
    <a href="{{ url_for('user.edit_profile') }}" class="nav-link-divider">Edit Profile</a>
    <a href="{{ url_for('jobs.job_listings') }}" class="nav-link-divider">Apply for a job</a>
    <a href="{{ url_for('user.application_history') }}" class="nav-link-divider">Application History</a>
    <a href="{{ url_for('user.contacts') }}" class="nav-link-divider">Support</a>
    <a href="{{ url_for('auth.user_logout') }}" class="nav-link-divider logout">Logout</a>
  </div>
</div>

{% endif %}


<!-- Main Content Area -->
{% block fullwidth %}{% endblock %}
<main class="container mt-5 pt-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} mt-3">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</main>
<br>

{% if not (current_user.is_authenticated and current_user.is_admin) %}
  {% include 'footer.html' %}
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<a href="https://wa.link/q5rjtp" class="whatsapp-float" target="_blank"
   style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;">
  <img src="{{ url_for('static', filename='images/whatsapp.png') }}" alt="WhatsApp" width="60">
</a>
<!-- user inactive for 10 minutes -->
<!-- Auto-logout after 10 minutes of inactivity -->
{% if current_user.is_authenticated %}
<script
  data-logout-url="{{ url_for('auth.admin_logout') if current_user.is_admin else url_for('auth.user_logout') }}"
  data-is-admin="{{ 'true' if current_user.is_admin else 'false' }}"
  id="inactivity-script">
</script>

<script>
  const scriptTag = document.getElementById("inactivity-script");
  const logoutUrl = scriptTag.dataset.logoutUrl;
  const isAdmin = scriptTag.dataset.isAdmin === 'true';

  let inactivityTimer;
  const logoutTime = 10 * 60 * 1000; // 10 minutes

  function resetInactivityTimer() {
    clearTimeout(inactivityTimer);
    inactivityTimer = setTimeout(() => {
      const userType = isAdmin ? "admin" : "user";
      alert("You have been logged out due to inactivity.");
      console.log(`Logging out ${userType} to: ${logoutUrl}`);
      window.location.href = logoutUrl;
    }, logoutTime);
  }

  // Initialize timer on page load
  window.addEventListener("load", resetInactivityTimer);
  
  // Reset timer on user activity
  document.addEventListener("mousemove", resetInactivityTimer);
  document.addEventListener("keypress", resetInactivityTimer);
  document.addEventListener("click", resetInactivityTimer);
  document.addEventListener("scroll", resetInactivityTimer);
  document.addEventListener("touchstart", resetInactivityTimer); // For mobile devices
</script>
{% endif %}